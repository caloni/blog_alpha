<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Blogue do Caloni - 2 Coelhos</title>
  <meta name="author" content="" />
  <meta name="generator" content="Hugo 0.110.0">
  <meta property="og:title" content="2 Coelhos"/>
  <meta property="og:type"
        content="article"/>
  <meta property="og:url" content="http://www.caloni.com.br/todo-put-original-title-slug/"/>
  <meta property="og:image"
        content="/img/author.jpg"/>
  <meta property="og:description"
        content="Uma montagem impec·vel consegue dar o tom da narrativa do complexo 2 Coelhos. AlÈm de complexo, existem pequenos detalhes da trama que forÁam um pouco a realidade (como a uni„o entre o protagonista e..."/>
  <link href="" rel="feed" type="application/rss+xml"
        title="Blogue do Caloni"/>
  <link rel="stylesheet" type="text/css" href="/css/custom.css"/>
  <link rel="stylesheet" type="text/css" href="/css/jquery-ui.css"/>
  <link rel="stylesheet" type="text/css" href="/css/board-min.css"/>
  <script src="/js/jquery-1.10.2.js"></script>
  <script src="/js/jquery-ui.js"></script>
  <script src="/js/pgnyui.js"></script>
  <script src="/js/pgnviewer.js"></script>
  <script src="/js/list.js"></script>
  <link rel="icon" href="/img/favicon.ico"/>
</head>
<body style="min-height:100vh;display:flex;flex-direction:column">
  <nav class="navbar has-shadow is-white"
        role="navigation" aria-label="main navigation">
  <div class="container">
  <div class="navbar-brand">
  <pre><span style="font-size: 3px; margin: 0; display: block;">
&amp;*/. .*%@@@@@@@@@@@@&amp;/    , &amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@#,*@@@@%,*&amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@./@.(@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@**#./((,*, *./((*,#,&amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@.#@@%&amp;@@* (@@%&amp;@@/#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@,#@@&amp;&amp;@@, (@@&amp;&amp;@@*#@@@@@@@@@@@@@#/,,.         ..,/#&amp;@@@@@@@@@@@@@@@@@@@@@@@
@@@@@&amp;, .//      .//  .%@@@@@@&amp;#.  .,****.,*************,.  .(&amp;@@@@@@@@@@@@@@@@@
@@@*                     ,@/  .**,,,*********,   ,***,   ****    *@@@@@@@@@@@@@@
@#                         ,***      .******       ,***,*****,      *&amp;@@@@@@@@@@
&amp;                           ,**      .******.     .******************  (@@@@@@@@
                             ****..,*************************,    ,***   (@@@@@@
@@@@#,,,,,,,,,,,,,,,,,,,,*********,   ,**************,  .***,      .**. .  %@@@@
@@@@%                   .***,.,****,.,***,     ,****      ***.     ,******, /@@@
@@@@@&amp;.                ,**       *******,       *****,  .******************, *@@
@@@@@@@&amp;,            ,****      .********,.   .*************,  ,*****,    ,** /@
@@@@@@@@@@@@&amp;/ .****,    ************.   ****************************      **. #
@@@@@@@@@@@@@, *****,    ,***********    .******,   ,****.   .*****,***,,***** ,
@@@@@@@@@@@@&amp;..**************,  ,***********************       ,*,    ********..
@@@@@@@@@@@@&amp; ,**.    ,******.  .*******.    .**********,     .**********. .**, 
@@@@@@@@@@@@% ,*       ,***************.      .*****************************,   
@@@@@@@@@@@@@&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;@,(&amp;&amp;&amp;&amp;@,(&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;#*@&amp;&amp;&amp;@*#&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
@@@@@@@@@@@@@@@@@@@@@@@@@@@@(.#@@@@(.#@@@@@@@@@@@@@@@@@@@@@#**@@@@(.#@@@@@@@@@@@
  </span></pre>
  &nbsp;
  <a class="navbar-item" title="Go to Home" href="/">
    <div class="is-6">Blogue do Caloni</div>
  </a>
  </div>
  </div>
  </nav>
  <div class="container">
  <p class="title">
  <a class="external" href="https://www.caloni.com.br/todo-put-external-link-here">
  Todo Put Post Title Here
  </a>
  </p>
  <div class="content">
<p>Acho que o que mais me impressionou at√© hoje a respeito do WinDbg √© a sua capacidade de depura√ß√£o remota. N√£o h√° nada como depurar problemas sentado confortavelmente na sua cadeira de programador em frente √† sua mesa de programador.</p>
<p>J√° √© fato consumado que os maiores problemas da humanidade ocorrem sempre no cliente, com uma rela√ß√£o de dificuldade diretamente proporcional ao cargo ocupado pelo usu√°rio da m√°quina que est√° dando problemas. Se esse cliente por acaso mora em um lugar t√£o t√£o distante, nada mais justo do que conhecermos algumas t√©cnicas de depura√ß√£o remota para continuar a mant√™-lo t√£o t√£o distante.</p>
<p>O ambiente de desenvolvimento (em teoria) n√£o se deve confundir com o ambiente de testes, um lugar onde o desenvolvedor deveria colocar o p√© somente quando fosse chamado e quando existisse um problema na vers√£o Release. Por isso e portanto a √∫nica coisa permitida em um ambiente de testes √© (deveria ser) um servidor de depura√ß√£o.</p>
<p>O servidor de depura√ß√£o nada mais √© do que um processo que deixa alguma porta aberta  na m√°quina de testes para que o desenvolvedor consiga facilmente depurar problemas que ocorreram durantes os testes de produ√ß√£o. Ele pode ser facilmente configurado atrav√©s da instala√ß√£o do pacote Debugging Tools for Windows.</p>
<p>Existem alguns cen√°rios muito comuns de depura√ß√£o remota que ser√£o abordados aqui. O resto dos cen√°rios se baseia nos exemplos abaixo, e pode ser montado com uma simples releitura dos t√≥picos de ajuda do WinDbg sobre o assunto (procure por dbgsrv.exe).</p>
<p>No caso de VM ou m√°quina de teste do lado do desenvolvedor podemos supor que a m√°quina tem total acesso e controle do desenvolvedor. Tudo o que temos que fazer √© iniciar um WinDbg na m√°quina-v√≠tima e outro WinDbg na m√°quina-programador. O WinDbg da m√°quina-v√≠tima deve ser iniciado no modo-servidor, enquanto o da m√°quina-programador no modo-cliente.</p>
<p>    windbg -server tcp:port=6666</p>
<p>    windbg -remote tcp:server=maquina-vitima,port=6666</p>
<p>A vantagem dessa t√©cnica √© que tanto o WinDbg da m√°quina-v√≠tima quanto o da m√°quina-programador podem emitir comandos, e todos v√™em os resultados. Uma poss√≠vel desvantagem √© que os s√≠mbolos devem estar dispon√≠veis a partir da m√°quina-v√≠tima.</p>
<p>Se for necess√°rio, √© poss√≠vel convidar mais gente pra festa, pois o WinDbg permite se transformar em uma inst√¢ncia servidora pelo comando .server, que possui a mesma sintaxe da linha de comando. Para a comunica√ß√£o entre todos esses depuradores ambulantes um comando muito √∫til √© o .echo.</p>
<p>    windbg -server tcp:port=6667 -remote tcp:server=maquina-vitima,port=6666</p>
<p>    windbg -remote tcp:server=maquina-vitima,port=6666</p>
<p>    0:000>.server tcp:port=6667</p>
<p>    MAQUINA-PROGRAMADOR66\caloni (tcp 222.234.235.236:1974) connected at Mon Mar 24 11:47:55 2008</p>
<p>    0:000>.echo E ae, galera? Como que a gente vai consertar essa &%$*&?</p>
<p>    0:000>.echo Putz, sei l√°. Acho que vou tomar mais caf√©...</p>
<p>{{< image src="windbg-remote.gif" caption="Windbg Remote" >}}</p>
<p>No ambiente do cliente √© muito mais hostil; √© salutar e recomend√°vel utilizar um servidor gen√©rico que n√£o imprima coisa alguma na tela "do outro lado". Ap√≥s iniciar o depurador na m√°quina que est√° dando o problema, o programador tem virtualmente uma s√©rie de comandos √∫teis que podem ser executados remotamente, como iniciar novos processos, se anexar a processos j√° existentes, copiar novas vers√µes de execut√°veis, etc.</p>
<p>O nome do processo do lado servidor para modo usu√°rio √© dbgsrv.exe. Para o modo kernel √© kdsrv.exe. Os par√¢metros de execu√ß√£o, felizmente, s√£o os mesmos que os do WinDbg (e CDB, NTSD e KD), o que evita ter que decorar uma nova s√©rie de comandos.</p>
<p>Pode parecer besteira falar isso aqui, mas ao depurar um sistema em modo kernel √© necess√°rio, √© claro, √© √≥bvio, √© l√≥gico, ter uma segunda m√°quina do lado servidor conectada por cabo serial ou firewire ou USB-Debug na m√°quina-v√≠tima. Ainda que o Debugging Tools permita uma s√©rie de flexibilidades, o depurador em modo kernel vai rodar direto do kernel (duh), ou seja, est√° limitado pela implementa√ß√£o do sistema operacional. Al√©m de que, para travar o processo do kernel, voc√™ tem que parar todo o sistema, e nesse caso n√£o existe pilha TCP/IP.</p>
<p>Para iniciar o servidor de depura√ß√£o e deixar as portas abertas para o depurador temos apenas que iniciar o processo dbgsrv.exe:</p>
<p>    dbgsrv -t tcp:port=6666</p>
<p>Para iniciar o processo depurador, a sintaxe √© quase a mesma, s√≥ que no lugar de remote especificamos premote:</p>
<p>    windbg -premote tcp:server=maquina-vitima,port=6666</p>
<p>Caso n√£o se saiba a porta usada para iniciar o servidor, ou queira-se listar todos os servidores dispon√≠veis em uma determinada m√°quina, usa-se o comando -QR.</p>
<p>    cdb -QR \\maquina-vitima</p>
<p>O exemplo acima utilizou uma conex√£o TCP para montar o ambiente de depura√ß√£o remota, o que possibilita inclusive corre√ß√£o de problemas via internet. No entanto, nem sempre podemos nos dar ao luxo de abrir portas n√£o-autorizadas, requisito m√≠nimo para estabelecer a conex√£o com o depurador. Nesse caso, podemos configurar conex√µes pela porta serial, por pipes nomeados, por SSL. Se for realmente necess√°rio usar a pilha TCP, mas o lado servidor possui um firewall, ainda assim √© poss√≠vel configurar este tipo de conex√£o com a op√ß√£o clicon. Dessa forma, quem estabelece a conex√£o √© o servidor, evitando que o cliente fique bloqueado de acessar o ambiente de depura√ß√£o.</p>
<p>{{< image src="windbg-remote2.gif" caption="Windbg Remote" >}}</p>
<p>√â importante notar que o dbgsrv.exe n√£o √© um depurador esperto, no sentido que ele n√£o vai carregar os s√≠mbolos para voc√™. Isso √© importante na hora de definir qual estrat√©gia utilizar, pois nem sempre os s√≠mbolos estar√£o dispon√≠veis na m√°quina com problemas, e nem sempre estar√£o com o desenvolvedor.</p>
<p>Uma organiza√ß√£o mais esperta dos ambientes de teste e desenvolvimento tomaria conta de outros problemas como s√≠mbolos e fontes com o uso de outras features poderosas do Debugging Tools como servidor de s√≠mbolos e servidor de fontes. Por√©m, a complica√ß√£o envolvida na configura√ß√£o desses dois me leva a crer que eles merecem um outro artigo. E √© por isso que paramos por aqui.</p>

</div>
  <div class="taglist">
  <p class="author">Wanderley Caloni,
     <a href="https://github.com/Caloni/blog/blob/master/content/posts/todo-dunno-original-post-source">
     2012-02-15 00:00:00 &#43;0000
     </a>
  </p>
  <a href="/categories/writting">writting</a> 
  <a href="/tags/movies">movies</a> 
  <a class="externalgray" href="https://t.me/paneloni">discuss</a>
  <script type="text/javascript" src="//cdn.livetrafficfeed.com/static/hitcounterjs/live.js?sty=49&min=1&sta=0&uni=1&tz=America%2FSao_Paulo&ro=0"></script><noscript id="LTF_hitcounter"><a href="https://livetrafficfeed.com/hit-counter">Hit Counter</a></noscript>
  </div>
  </div>
  </body>
  </html>
