<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Blogue do Caloni - 2 Coelhos</title>
  <meta name="author" content="" />
  <meta name="generator" content="Hugo 0.110.0">
  <meta property="og:title" content="2 Coelhos"/>
  <meta property="og:type"
        content="article"/>
  <meta property="og:url" content="http://www.caloni.com.br/todo-put-original-title-slug/"/>
  <meta property="og:image"
        content="/img/author.jpg"/>
  <meta property="og:description"
        content="Uma montagem impec·vel consegue dar o tom da narrativa do complexo 2 Coelhos. AlÈm de complexo, existem pequenos detalhes da trama que forÁam um pouco a realidade (como a uni„o entre o protagonista e..."/>
  <link href="" rel="feed" type="application/rss+xml"
        title="Blogue do Caloni"/>
  <link rel="stylesheet" type="text/css" href="/css/custom.css"/>
  <link rel="stylesheet" type="text/css" href="/css/jquery-ui.css"/>
  <link rel="stylesheet" type="text/css" href="/css/board-min.css"/>
  <script src="/js/jquery-1.10.2.js"></script>
  <script src="/js/jquery-ui.js"></script>
  <script src="/js/pgnyui.js"></script>
  <script src="/js/pgnviewer.js"></script>
  <script src="/js/list.js"></script>
  <link rel="icon" href="/img/favicon.ico"/>
</head>
<body style="min-height:100vh;display:flex;flex-direction:column">
  <nav class="navbar has-shadow is-white"
        role="navigation" aria-label="main navigation">
  <div class="container">
  <div class="navbar-brand">
  <pre><span style="font-size: 3px; margin: 0; display: block;">
&amp;*/. .*%@@@@@@@@@@@@&amp;/    , &amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@#,*@@@@%,*&amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@./@.(@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@**#./((,*, *./((*,#,&amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@.#@@%&amp;@@* (@@%&amp;@@/#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@,#@@&amp;&amp;@@, (@@&amp;&amp;@@*#@@@@@@@@@@@@@#/,,.         ..,/#&amp;@@@@@@@@@@@@@@@@@@@@@@@
@@@@@&amp;, .//      .//  .%@@@@@@&amp;#.  .,****.,*************,.  .(&amp;@@@@@@@@@@@@@@@@@
@@@*                     ,@/  .**,,,*********,   ,***,   ****    *@@@@@@@@@@@@@@
@#                         ,***      .******       ,***,*****,      *&amp;@@@@@@@@@@
&amp;                           ,**      .******.     .******************  (@@@@@@@@
                             ****..,*************************,    ,***   (@@@@@@
@@@@#,,,,,,,,,,,,,,,,,,,,*********,   ,**************,  .***,      .**. .  %@@@@
@@@@%                   .***,.,****,.,***,     ,****      ***.     ,******, /@@@
@@@@@&amp;.                ,**       *******,       *****,  .******************, *@@
@@@@@@@&amp;,            ,****      .********,.   .*************,  ,*****,    ,** /@
@@@@@@@@@@@@&amp;/ .****,    ************.   ****************************      **. #
@@@@@@@@@@@@@, *****,    ,***********    .******,   ,****.   .*****,***,,***** ,
@@@@@@@@@@@@&amp;..**************,  ,***********************       ,*,    ********..
@@@@@@@@@@@@&amp; ,**.    ,******.  .*******.    .**********,     .**********. .**, 
@@@@@@@@@@@@% ,*       ,***************.      .*****************************,   
@@@@@@@@@@@@@&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;@,(&amp;&amp;&amp;&amp;@,(&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;#*@&amp;&amp;&amp;@*#&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
@@@@@@@@@@@@@@@@@@@@@@@@@@@@(.#@@@@(.#@@@@@@@@@@@@@@@@@@@@@#**@@@@(.#@@@@@@@@@@@
  </span></pre>
  &nbsp;
  <a class="navbar-item" title="Go to Home" href="/">
    <div class="is-6">Blogue do Caloni</div>
  </a>
  </div>
  </div>
  </nav>
  <div class="container">
  <p class="title">
  <a class="external" href="https://www.caloni.com.br/todo-put-external-link-here">
  Todo Put Post Title Here
  </a>
  </p>
  <div class="content">
<p>Voc√™ j√° colocou aquele seu projeto favorito em /W4? Por padr√£o, o Visual Studio cria seus projetos com o n√≠vel de warnings e 3, porque o n√≠vel 4 √© muito, muito chato. No entanto, algumas vezes ele serve para que seu c√≥digo n√£o fique apenas correto, mas bem documentado e apresent√°vel. Vamos tentar?</p>
<p>```</p>
<p>1>------ Build started: Project: tioserver, Configuration: Debug x64 ------</p>
<p>1>  pch.cpp</p>
<p>1>  using Boost version 1_62</p>
<p>1>  tioclient.c</p>
<p>1>cl : Command line warning D9030: '/Gm' is incompatible with multiprocessing; ignoring /MP switch</p>
<p>1>  TioTcpSession.cpp</p>
<p>1>  TioTcpServer.cpp</p>
<p>1>  TioPython.cpp</p>
<p>1>  tio.cpp</p>
<p>1>  ContainerManager.cpp</p>
<p>1>  Command.cpp</p>
<p>1>  Generating Code...</p>
<p>1>  tioserver.vcxproj -> C:\Projects\tiodb\server\tio\..\..\bin\x64\Debug\tio.exe</p>
<p>1>  tioserver.vcxproj -> ..\..\bin\x64\Debug\tio.pdb (Full PDB)</p>
<p>```</p>
<p>OK, este foi o n√≠vel 3 do tioserver, o projeto principal do [tiodb](https://github.com/tiodb), uma ferramenta para manter cont√™ineres assin√°veis na mem√≥ria e acess√≠veis via socket. Note que j√° existe um warning, mas vamos ignorar por enquanto. O objetivo aqui √© descobrir quais os warnings mais comuns do projeto que voc√™ vai escolher. Vejamos o meu:</p>
<p>{{< image src="XjbqVh9.png" caption="" >}}</p>
<p>```</p>
<p>1>------ Rebuild All started: Project: tioserver, Configuration: Debug x64 ------</p>
<p>1>  pch.cpp</p>
<p>1>  using Boost version 1_62</p>
<p>1>  tioclient.c</p>
<p>1>c:\projects\tiodb\client\c\tioclient.c(218): warning C4701: potentially uninitialized local variable 'start' used</p>
<p>1>cl : Command line warning D9030: '/Gm' is incompatible with multiprocessing; ignoring /MP switch</p>
<p>1>  TioTcpSession.cpp</p>
<p>1>c:\projects\tiodb\server\tio\tiotcpsession.h(299): warning C4458: declaration of 'eventName' hides class member</p>
<p>1>  c:\projects\tiodb\server\tio\tiotcpsession.h(295): note: see declaration of 'tio::EXTRA_EVENT::eventName'</p>
<p>1>c:\projects\tiodb\server\tio\logdb.h(213): warning C4456: declaration of 'i' hides previous local declaration</p>
<p>1>  c:\projects\tiodb\server\tio\logdb.h(200): note: see declaration of 'i'</p>
<p>1>c:\projects\tiodb\server\tio\tiotcpserver.h(81): warning C4456: declaration of 'handle' hides previous local declaration</p>
<p>1>  c:\projects\tiodb\server\tio\tiotcpserver.h(77): note: see declaration of 'handle'</p>
<p>1>c:\projects\tiodb\server\tio\tiotcpserver.h(413): warning C4456: declaration of 'b' hides previous local declaration</p>
<p>1>  c:\projects\tiodb\server\tio\tiotcpserver.h(316): note: see declaration of 'b'</p>
<p>1>c:\projects\tiodb\server\tio\tiotcpsession.cpp(127): warning C4457: declaration of 'key' hides function parameter</p>
<p>1>  c:\projects\tiodb\server\tio\tiotcpsession.cpp(114): note: see declaration of 'key'</p>
<p>1>  TioTcpServer.cpp</p>
<p>1>c:\projects\tiodb\server\tio\tiotcpsession.h(299): warning C4458: declaration of 'eventName' hides class member</p>
<p>1>  c:\projects\tiodb\server\tio\tiotcpsession.h(295): note: see declaration of 'tio::EXTRA_EVENT::eventName'</p>
<p>1>c:\projects\tiodb\server\tio\logdb.h(213): warning C4456: declaration of 'i' hides previous local declaration</p>
<p>1>  c:\projects\tiodb\server\tio\logdb.h(200): note: see declaration of 'i'</p>
<p>1>c:\projects\tiodb\server\tio\tiotcpserver.h(81): warning C4456: declaration of 'handle' hides previous local declaration</p>
<p>1>  c:\projects\tiodb\server\tio\tiotcpserver.h(77): note: see declaration of 'handle'</p>
<p>1>c:\projects\tiodb\server\tio\tiotcpserver.h(413): warning C4456: declaration of 'b' hides previous local declaration</p>
<p>1>  c:\projects\tiodb\server\tio\tiotcpserver.h(316): note: see declaration of 'b'</p>
<p>1>c:\projects\tiodb\server\tio\tiotcpserver.cpp(404): warning C4456: declaration of 'b' hides previous local declaration</p>
<p>1>  c:\projects\tiodb\server\tio\tiotcpserver.cpp(300): note: see declaration of 'b'</p>
<p>1>c:\projects\tiodb\server\tio\tiotcpserver.cpp(563): warning C4456: declaration of 'b' hides previous local declaration</p>
<p>1>  c:\projects\tiodb\server\tio\tiotcpserver.cpp(300): note: see declaration of 'b'</p>
<p>1>c:\projects\tiodb\server\tio\tiotcpserver.cpp(596): warning C4456: declaration of 'b' hides previous local declaration</p>
<p>1>  c:\projects\tiodb\server\tio\tiotcpserver.cpp(300): note: see declaration of 'b'</p>
<p>1>c:\projects\tiodb\server\tio\tiotcpserver.cpp(620): warning C4456: declaration of 'b' hides previous local declaration</p>
<p>1>  c:\projects\tiodb\server\tio\tiotcpserver.cpp(300): note: see declaration of 'b'</p>
<p>1>c:\projects\tiodb\server\tio\tiotcpserver.cpp(643): warning C4456: declaration of 'b' hides previous local declaration</p>
<p>1>  c:\projects\tiodb\server\tio\tiotcpserver.cpp(300): note: see declaration of 'b'</p>
<p>1>c:\projects\tiodb\server\tio\tiotcpserver.cpp(661): warning C4456: declaration of 'b' hides previous local declaration</p>
<p>1>  c:\projects\tiodb\server\tio\tiotcpserver.cpp(300): note: see declaration of 'b'</p>
<p>1>c:\projects\tiodb\server\tio\tiotcpserver.cpp(2451): warning C4456: declaration of 'value' hides previous local declaration</p>
<p>1>  c:\projects\tiodb\server\tio\tiotcpserver.cpp(2338): note: see declaration of 'value'</p>
<p>1>  TioPython.cpp</p>
<p>1>  tio.cpp</p>
<p>1>c:\projects\tiodb\server\tio\tiotcpsession.h(299): warning C4458: declaration of 'eventName' hides class member</p>
<p>1>  c:\projects\tiodb\server\tio\tiotcpsession.h(295): note: see declaration of 'tio::EXTRA_EVENT::eventName'</p>
<p>1>c:\projects\tiodb\server\tio\logdb.h(213): warning C4456: declaration of 'i' hides previous local declaration</p>
<p>1>  c:\projects\tiodb\server\tio\logdb.h(200): note: see declaration of 'i'</p>
<p>1>c:\projects\tiodb\server\tio\tiotcpserver.h(81): warning C4456: declaration of 'handle' hides previous local declaration</p>
<p>1>  c:\projects\tiodb\server\tio\tiotcpserver.h(77): note: see declaration of 'handle'</p>
<p>1>c:\projects\tiodb\server\tio\tiotcpserver.h(413): warning C4456: declaration of 'b' hides previous local declaration</p>
<p>1>  c:\projects\tiodb\server\tio\tiotcpserver.h(316): note: see declaration of 'b'</p>
<p>1>  ContainerManager.cpp</p>
<p>1>  Command.cpp</p>
<p>1>  Generating Code...</p>
<p>1>  tioserver.vcxproj -> C:\Projects\tiodb\server\tio\..\..\bin\x64\Debug\tio.exe</p>
<p>1>  tioserver.vcxproj -> ..\..\bin\x64\Debug\tio.pdb (Full PDB)</p>
<p>```</p>
<p>Vamos ordenar e capturar apenas o c√≥digo desses warnings para ver quantos ocorrem e quais os mais comuns:</p>
<p>```</p>
<p>sort</p>
<p>s/c:\\.*: \(warning C[0-9]\+\).*$/\1/</p>
<p>sort u</p>
<p>```</p>
<p>```</p>
<p>warning C4456: declaration of 'identifier' hides previous local declaration</p>
<p>warning C4457: declaration of 'identifier' hides function parameter</p>
<p>warning C4458: declaration of 'identifier' hides class member</p>
<p>warning C4701: potentially uninitialized local variable 'name' used</p>
<p>```</p>
<p>Apenas quatro. T√£o comuns que [a maioria](https://msdn.microsoft.com/en-us/library/mt694070.aspx) est√° at√© em ordem num√©rica e diz respeito a repeti√ß√£o de nomes em escopos diferentes, o que esconde os nomes do escopo anterior, mais amplo. O outro, o [C4701](https://msdn.microsoft.com/en-us/library/1wea5zwe.aspx), pode ser mais problem√°tico, j√° que ele representa uma vari√°vel que potencialmente n√£o foi inicializada, fonte comum daqueles erros de "como √© que essa vari√°vel virou isso?".</p>
<p>Felizmente s√≥ temos em um ponto do c√≥digo:</p>
<p>```</p>
<p>// Contract: </p>
<p>//		if no timeout, it will hang until all bytes are returned</p>
<p>//		if timeout is set, we can return less bytes than requested</p>
<p>int socket_receive(SOCKET socket, void* buffer, int len, const unsigned* timeout_in_seconds)</p>
<p>	int ret = 0;</p>
<p>	char* char_buffer = (char*)buffer;</p>
<p>	int received = 0;</p>
<p>	time_t start;</p>
<p>	int time_left;</p>
<p>#if _WIN32</p>
<p>	FD_SET recvset;</p>
<p>	struct timeval tv;</p>
<p>#endif</p>
<p>#ifdef _DEBUG</p>
<p>	memset(char_buffer, 0xFF, len);</p>
<p>#endif</p>
<p>	if(timeout_in_seconds)</p>
<p>		start = time(NULL);</p>
<p>	while(received < len)</p>
<p>		if(timeout_in_seconds)</p>
<p>		{</p>
<p>			time_left = *timeout_in_seconds - (int)(time(NULL) - start);</p>
<p>```</p>
<p>Vamos dar uma olhada em um dos outros warnings:</p>
<p>```</p>
<p>```</p>
<p>OK, isso √© meio feio. A vari√°vel handle tinha acabado de ser criada logo antes da entrada do if. A n√£o ser que sejam de fato vari√°veis distintas no c√≥digo (apenas analisando a fun√ß√£o inteira) elas poderiam ser reaproveitadas em apenas uma (at√© porque possuem o mesmo tipo). E se forem vari√°veis distintas... bem, coloque nomes distintos =)</p>
</div>
  <div class="taglist">
  <p class="author">Wanderley Caloni,
     <a href="https://github.com/Caloni/blog/blob/master/content/posts/todo-dunno-original-post-source">
     2012-02-15 00:00:00 &#43;0000
     </a>
  </p>
  <a href="/categories/writting">writting</a> 
  <a href="/tags/movies">movies</a> 
  <a class="externalgray" href="https://t.me/paneloni">discuss</a>
  <script type="text/javascript" src="//cdn.livetrafficfeed.com/static/hitcounterjs/live.js?sty=49&min=1&sta=0&uni=1&tz=America%2FSao_Paulo&ro=0"></script><noscript id="LTF_hitcounter"><a href="https://livetrafficfeed.com/hit-counter">Hit Counter</a></noscript>
  </div>
  </div>
  </body>
  </html>
