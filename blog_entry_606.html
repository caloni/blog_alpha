<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Blogue do Caloni - 2 Coelhos</title>
  <meta name="author" content="" />
  <meta name="generator" content="Hugo 0.110.0">
  <meta property="og:title" content="2 Coelhos"/>
  <meta property="og:type"
        content="article"/>
  <meta property="og:url" content="http://www.caloni.com.br/todo-put-original-title-slug/"/>
  <meta property="og:image"
        content="/img/author.jpg"/>
  <meta property="og:description"
        content="Uma montagem impec·vel consegue dar o tom da narrativa do complexo 2 Coelhos. AlÈm de complexo, existem pequenos detalhes da trama que forÁam um pouco a realidade (como a uni„o entre o protagonista e..."/>
  <link href="" rel="feed" type="application/rss+xml"
        title="Blogue do Caloni"/>
  <link rel="stylesheet" type="text/css" href="/css/custom.css"/>
  <link rel="stylesheet" type="text/css" href="/css/jquery-ui.css"/>
  <link rel="stylesheet" type="text/css" href="/css/board-min.css"/>
  <script src="/js/jquery-1.10.2.js"></script>
  <script src="/js/jquery-ui.js"></script>
  <script src="/js/pgnyui.js"></script>
  <script src="/js/pgnviewer.js"></script>
  <script src="/js/list.js"></script>
  <link rel="icon" href="/img/favicon.ico"/>
</head>
<body style="min-height:100vh;display:flex;flex-direction:column">
  <nav class="navbar has-shadow is-white"
        role="navigation" aria-label="main navigation">
  <div class="container">
  <div class="navbar-brand">
  <pre><span style="font-size: 3px; margin: 0; display: block;">
&amp;*/. .*%@@@@@@@@@@@@&amp;/    , &amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@#,*@@@@%,*&amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@./@.(@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@**#./((,*, *./((*,#,&amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@.#@@%&amp;@@* (@@%&amp;@@/#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@,#@@&amp;&amp;@@, (@@&amp;&amp;@@*#@@@@@@@@@@@@@#/,,.         ..,/#&amp;@@@@@@@@@@@@@@@@@@@@@@@
@@@@@&amp;, .//      .//  .%@@@@@@&amp;#.  .,****.,*************,.  .(&amp;@@@@@@@@@@@@@@@@@
@@@*                     ,@/  .**,,,*********,   ,***,   ****    *@@@@@@@@@@@@@@
@#                         ,***      .******       ,***,*****,      *&amp;@@@@@@@@@@
&amp;                           ,**      .******.     .******************  (@@@@@@@@
                             ****..,*************************,    ,***   (@@@@@@
@@@@#,,,,,,,,,,,,,,,,,,,,*********,   ,**************,  .***,      .**. .  %@@@@
@@@@%                   .***,.,****,.,***,     ,****      ***.     ,******, /@@@
@@@@@&amp;.                ,**       *******,       *****,  .******************, *@@
@@@@@@@&amp;,            ,****      .********,.   .*************,  ,*****,    ,** /@
@@@@@@@@@@@@&amp;/ .****,    ************.   ****************************      **. #
@@@@@@@@@@@@@, *****,    ,***********    .******,   ,****.   .*****,***,,***** ,
@@@@@@@@@@@@&amp;..**************,  ,***********************       ,*,    ********..
@@@@@@@@@@@@&amp; ,**.    ,******.  .*******.    .**********,     .**********. .**, 
@@@@@@@@@@@@% ,*       ,***************.      .*****************************,   
@@@@@@@@@@@@@&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;@,(&amp;&amp;&amp;&amp;@,(&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;#*@&amp;&amp;&amp;@*#&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
@@@@@@@@@@@@@@@@@@@@@@@@@@@@(.#@@@@(.#@@@@@@@@@@@@@@@@@@@@@#**@@@@(.#@@@@@@@@@@@
  </span></pre>
  &nbsp;
  <a class="navbar-item" title="Go to Home" href="/">
    <div class="is-6">Blogue do Caloni</div>
  </a>
  </div>
  </div>
  </nav>
  <div class="container">
  <p class="title">
  <a class="external" href="https://www.caloni.com.br/todo-put-external-link-here">
  Todo Put Post Title Here
  </a>
  </p>
  <div class="content">
<p>√â l√≥gico que n√£o poderia faltar no cinto de utilidades de todo bom programador C conhecimentos **b√°sicos** da linguagem [assembly](http://pt.wikipedia.org/wiki/Assembly), sua m√£e espiritual. S√£o tantos conceitos em comum que, uma vez aprendido seu funcionamento, fica dif√≠cil n√£o pensar no c√≥digo-assembly gerado pelo compilador C. E √© nesse ponto que as coisas come√ßam a ficar mais claras.</p>
<p>Antes de tudo, √© important√≠ssimo lembrar que o foco aqui √© apenas a arquitetura **8086**, um dos marcos na inven√ß√£o de computadores de massa, mas que existem trocentros outros modelos de processadores e computadores funcionando mundo afora. N√£o deixe sua mente fechar para os outros tipos de modelos.</p>
<p>A CPU trabalha em conjunto com a mem√≥ria RAM. S√≥ que o acesso √† essa mem√≥ria, apesar de r√°pida, n√£o √© compar√°vel √† velocidade em que as coisas ocorrem dentro da pr√≥pria CPU. Esse √© apenas um dos motivos para a exist√™ncia de um conjunto bem menor de mem√≥ria que vive nas entranhas do processador, bem ao lado dele. S√£o os chamados **registradores**.</p>
<p>{{< image src="kcKufIn.gif" caption="Registradores da CPU" >}}</p>
<p>Os registradores s√£o mem√≥ria do tipo ultra-r√°pida que funciona **no mesmo ritmo do processador**. A maioria das instru√ß√µes executadas pela CPU faz refer√™ncia a pelo menos um registrador. E por um motivo muito simples: √© o modelo de entrada-e-sa√≠da funcionando!</p>
<p>No modelo de entrada-e-sa√≠da, ultrassimplificado por mim nesse artigo, o processador executa microinstru√ß√µes muito b√°sicas, que juntas fazem alguma coisa de √∫til, por exemplo, somar dois n√∫meros:</p>
<p>x = y + z;</p>
<p>A opera√ß√£o acima √© realizada atrav√©s de microinstru√ß√µes bem sucintas:</p>
<p>  1. Leia mem√≥ria y para registrador 1</p>
<p>  2. Leia mem√≥ria z para registrador 2</p>
<p>  3. Some valor de registrador 1 e 2 e coloque resultado no registrador 1</p>
<p>  4. Carregue mem√≥ria x com valor do registrador 1</p>
<p>{{< image src="N90ooMD.gif" caption="Os registradores da CPU em a√ß√£o" >}}</p>
<p>√â l√≥gico que o sistema n√£o se baseia apenas em movimenta√ß√µes simples de mem√≥ria. Existem algumas abstra√ß√µes que est√£o incrustadas no funcionamento da arquitetura. Uma das mais importantes √© o conceito de **pilha**, vital tanto em arquitetura, quanto assembly, quanto linguagem C e muitas outras linguagens, tamb√©m.</p>
<p>Pilha √© uma forma de armazenar mem√≥ria em blocos empilhados um-a-um. Esses blocos s√£o empilhados na ordem a, b, c e desempilhados na ordem c, b, a. Ou seja, quem foi empilhado por √∫ltimo ser√° o primeiro a ser desempilhado. A analogia com uma pilha de pratos √© √≥bvia e simples de imaginar.</p>
<p>{{< image src="EmiZKdc.gif" caption="Pratos de cozinha empilhados." >}}</p>
<p>{{< image src="wZ6kKs8.jpg" caption="Exemplo de pilha na mem√≥ria." >}}</p>
<p>Para isso funcionar em termos de mem√≥ria computacional, o programa reserva um espa√ßo de mem√≥ria com come√ßo e fim que ir√° guardar os blocos empilhados. Al√©m de ter come√ßo e fim √© necess√°rio ter um marcador de onde estamos para empilhar o pr√≥ximo item ou desempilhar o √∫ltimo.</p>
<p>Se voc√™ pensou r√°pido, a resposta √© sim, existem registradores para guardar a posi√ß√£o na pilha em que estamos. Ali√°s, quando mudamos de fun√ß√£o, o valor desses registradores √© salvo na pr√≥pria pilha, j√° que voltaremos √† mesma posi√ß√£o ap√≥s a chamada.</p>
<p><blockquote>Um passado distante.</p>
<p>Antigamente eram muito usados os chamados registradores de segmento. Eles representavam o endere√ßamento da arquitetura de 16 bits do 8086. Cada endere√ßo de mem√≥ria estava localizado em um segmento, que era uma abstra√ß√£o para multiplicar a mem√≥ria e assim alcan√ßar a quantidade de RAM que estava dispon√≠vel no sistema. Com a chegada do 32 bits, isso n√£o √© mais usado diretamente pelos programadores, que n√£o t√™m que se preocupar mais tanto com esses detalhes internos da mem√≥ria.</blockquote></p>
<p>Resumidamente, temos no PC os seguintes tipos de registradores e seu uso geral na programa√ß√£o C:</p>
<p>Registradores de uso geral. **EAX, EBX, ECX, EDX**.</p>
<p>Registradores de c√≥digo e dados. **ESP, EBP, EIP**.</p>
<p>Voc√™ os ver√° em 90% das ocasi√µes em que desassemblar seu c√≥digo C, pois a rotina do c√≥digo n√£o muda muito: soma, divide, multiplica, muda endere√ßo do c√≥digo (saltos), compara valores (flags).</p>
<p>#### Flags?</p>
<p>Ah, sim, as flags! Elas s√£o important√≠ssimas para o funcionamento sadio de nossos programas. Sem as flags, n√£o ter√≠amos coisas maravilhosas e fundamentais na programa√ß√£o moderna, tais como o [salto condicional](http://www.caloni.com.br/a-inteligencia-do-if-parte-1).</p>
<p>As flags s√£o bits que **mudam de acordo com algumas instru√ß√µes**, principalmente as de **compara√ß√£o** (vide cmp). Ap√≥s a execu√ß√£o de compara√ß√£o, o estado de determinadas flags junto da pr√≥xima instru√ß√£o (que dever√° ser um salto condicional) ir√° dizer para onde o programa ir√° pular sua execu√ß√£o. √â assim que temos o if:</p>
<p>if( x == 10 )XEhIgualA10();elseXEhDiferenteDe10();</p>
<p>O c√≥digo acima seria representado em assembly mais ou menos como abaixo:</p>
<p>1. carrega valor de x no registrador 1 2. compara registrador 1 com 10 3. pula para 6 se for diferente 4. chama XEhIgualA105. pula para 76. chama XEhDiferenteDe107. pr√≥xima instru√ß√£o</p>
<p><blockquote>Uma curiosidade interessante √© a flag de compara√ß√£o. Se o resultado da compara√ß√£o disser que os dois elementos s√£o iguais, a flag fica igual a zero, o que significa que os comparandos s√£o id√™nticos. Se voc√™ reparar, a mesma sem√¢ntica √© utilizada na conhecida fun√ß√£o strcmp, que retorna zero caso duas strings sejam id√™nticas. Isso faz sentido em ambos os lados, j√° que o resultado computacional geralmente deixa um rastro de diferen√ßa que √© usado como retorno. Se esse rastro n√£o existir, quer dizer que o que foi comparado √© id√™ntico.</blockquote></p>
<p>#### Opcodes para aprender:</p>
<p>  * mov</p>
<p>  * cmp</p>
<p>  * jmp</p>
<p>  * jne, jle, jnz, etc</p>
<p>  * push e pop</p>
<p>  * call e ret</p>
<p>#### Peda√ßos de c√≥digo que vale a pena estudar:</p>
<p>    push ebp</p>
<p>    mov epb, esp</p>
<p>	</p>
<p>    push eax</p>
<p>    mov ecx, dword ptr[variavel]</p>
<p>    push 10</p>
<p>    call funcao</p>
<p>    cmp something</p>
<p>    jne | jne | jae | ...</p>
<p>#### O que √© legal de fazer para treinar assembly</p>
<p>Desmonte programas, chamadas API. Veja que fun√ß√µes internas elas chamam para realizar determinada tarefa. Tente mudar o comportamento do programa para provar que suas observa√ß√µes sobre o funcionamento estavam corretas.</p>
<p>PS.: Ia me esquecendo. Enquanto estava escrevendo este artigo, um [conjunto](http://dqsoft.blogspot.com/2009/01/simulando-um-computador-14.html) [bem](http://dqsoft.blogspot.com/2009/01/simulando-um-computador-24.html) [mais](http://dqsoft.blogspot.com/2009/01/simulando-um-computador-34.html) [detalhado](http://dqsoft.blogspot.com/2009/01/simulando-um-computador-44.html) de artigos estava sendo publicado pelo DQ. Recomendo veementemente sua leitura.</p>

</div>
  <div class="taglist">
  <p class="author">Wanderley Caloni,
     <a href="https://github.com/Caloni/blog/blob/master/content/posts/todo-dunno-original-post-source">
     2012-02-15 00:00:00 &#43;0000
     </a>
  </p>
  <a href="/categories/writting">writting</a> 
  <a href="/tags/movies">movies</a> 
  <a class="externalgray" href="https://t.me/paneloni">discuss</a>
  <script type="text/javascript" src="//cdn.livetrafficfeed.com/static/hitcounterjs/live.js?sty=49&min=1&sta=0&uni=1&tz=America%2FSao_Paulo&ro=0"></script><noscript id="LTF_hitcounter"><a href="https://livetrafficfeed.com/hit-counter">Hit Counter</a></noscript>
  </div>
  </div>
  </body>
  </html>
