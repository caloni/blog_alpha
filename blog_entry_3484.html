<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Blogue do Caloni - 2 Coelhos</title>
  <meta name="author" content="" />
  <meta name="generator" content="Hugo 0.110.0">
  <meta property="og:title" content="2 Coelhos"/>
  <meta property="og:type"
        content="article"/>
  <meta property="og:url" content="http://www.caloni.com.br/todo-put-original-title-slug/"/>
  <meta property="og:image"
        content="/img/author.jpg"/>
  <meta property="og:description"
        content="Uma montagem impec·vel consegue dar o tom da narrativa do complexo 2 Coelhos. AlÈm de complexo, existem pequenos detalhes da trama que forÁam um pouco a realidade (como a uni„o entre o protagonista e..."/>
  <link href="" rel="feed" type="application/rss+xml"
        title="Blogue do Caloni"/>
  <link rel="stylesheet" type="text/css" href="/css/custom.css"/>
  <link rel="stylesheet" type="text/css" href="/css/jquery-ui.css"/>
  <link rel="stylesheet" type="text/css" href="/css/board-min.css"/>
  <script src="/js/jquery-1.10.2.js"></script>
  <script src="/js/jquery-ui.js"></script>
  <script src="/js/pgnyui.js"></script>
  <script src="/js/pgnviewer.js"></script>
  <script src="/js/list.js"></script>
  <link rel="icon" href="/img/favicon.ico"/>
</head>
<body style="min-height:100vh;display:flex;flex-direction:column">
  <nav class="navbar has-shadow is-white"
        role="navigation" aria-label="main navigation">
  <div class="container">
  <div class="navbar-brand">
  <pre><span style="font-size: 3px; margin: 0; display: block;">
&amp;*/. .*%@@@@@@@@@@@@&amp;/    , &amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@#,*@@@@%,*&amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@./@.(@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@**#./((,*, *./((*,#,&amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@.#@@%&amp;@@* (@@%&amp;@@/#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@,#@@&amp;&amp;@@, (@@&amp;&amp;@@*#@@@@@@@@@@@@@#/,,.         ..,/#&amp;@@@@@@@@@@@@@@@@@@@@@@@
@@@@@&amp;, .//      .//  .%@@@@@@&amp;#.  .,****.,*************,.  .(&amp;@@@@@@@@@@@@@@@@@
@@@*                     ,@/  .**,,,*********,   ,***,   ****    *@@@@@@@@@@@@@@
@#                         ,***      .******       ,***,*****,      *&amp;@@@@@@@@@@
&amp;                           ,**      .******.     .******************  (@@@@@@@@
                             ****..,*************************,    ,***   (@@@@@@
@@@@#,,,,,,,,,,,,,,,,,,,,*********,   ,**************,  .***,      .**. .  %@@@@
@@@@%                   .***,.,****,.,***,     ,****      ***.     ,******, /@@@
@@@@@&amp;.                ,**       *******,       *****,  .******************, *@@
@@@@@@@&amp;,            ,****      .********,.   .*************,  ,*****,    ,** /@
@@@@@@@@@@@@&amp;/ .****,    ************.   ****************************      **. #
@@@@@@@@@@@@@, *****,    ,***********    .******,   ,****.   .*****,***,,***** ,
@@@@@@@@@@@@&amp;..**************,  ,***********************       ,*,    ********..
@@@@@@@@@@@@&amp; ,**.    ,******.  .*******.    .**********,     .**********. .**, 
@@@@@@@@@@@@% ,*       ,***************.      .*****************************,   
@@@@@@@@@@@@@&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;@,(&amp;&amp;&amp;&amp;@,(&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;#*@&amp;&amp;&amp;@*#&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
@@@@@@@@@@@@@@@@@@@@@@@@@@@@(.#@@@@(.#@@@@@@@@@@@@@@@@@@@@@#**@@@@(.#@@@@@@@@@@@
  </span></pre>
  &nbsp;
  <a class="navbar-item" title="Go to Home" href="/">
    <div class="is-6">Blogue do Caloni</div>
  </a>
  </div>
  </div>
  </nav>
  <div class="container">
  <p class="title">
  <a class="external" href="https://www.caloni.com.br/todo-put-external-link-here">
  Todo Put Post Title Here
  </a>
  </p>
  <div class="content">
<p>Algumas coisas em C parecem t√£o simples na programa√ß√£o do dia-a-dia que em alguns momentos podem existir situa√ß√µes confusas e misteriosas. O uso obscuro do operador sizeof, por exemplo, pode dar margem a interpreta√ß√µes erradas a respeito do que est√° acontecendo por debaixo dos panos. Apesar do padr√£o ter sido elaborado para tentar tornar a linguagem uma coisa intuitiva e de f√°cil dedu√ß√£o, isso n√£o acontece todas as vezes.</p>
<p>Vamos tomar, por exemplo, o seguinte minic√≥digo:</p>
<p>    size_t len = sizeof("A simple string");</p>
<p>    memcpy(buf, "A simple string", len);</p>
<p>A pergunta ing√™nua: quantos bytes s√£o copiados para buf?</p>
<p>A resposta ing√™nua: er... o tamanho de "A simple string"?</p>
<p>Agora vamos supor que voc√™ √© um pouco mais esperto e come√ßa a pensar: "mas, pera√≠, estou passando na realidade um ponteiro para sizeof, o que quer dizer que, se meus c√°lculos estiverem corretos, e estivermos em uma plataforma de 32 bits, sizeof deve retornar 4, o que quer dizer que acabei de achar um bug escabroso, uhuu!".</p>
<p>Muito bem, o racioc√≠nio √© perfeito. Afinal de contas, "A simple string" √© um ponteiro para um array de caracteres terminados em zero, certo?</p>
<p>Estou quase certo disso. Por√©m, isso quer dizer que j√° deixei v√°rios bugs escabrosos h√° uns 4 anos atr√°s em trechos de c√≥digo parecidos com esse. Ser√° que eu estava errado e n√£o me dei conta, ou sabia de algo que esqueci faz muito tempo?</p>
<p>Eu e meu amigo demos uma olhada no padr√£o da linguagem C de 89 (revis√£o de 90), que diz duas coisas muito importantes nesse momento: o que √© um sizeof e o que √© uma string constante (chamada no padr√£o de string literal):</p>
<p>> #### Sizeof (6.3.3.4)</p>
<p>></p>
<p>> The sizeof operator yields the size (in bytes) of its operand, which may be an expression or the parenthesized name of a type. The size is determined from the type of the operand, which is not itself evaluated. The result is an integer constant.</p>
<p>></p>
<p>> #### String literal (6.1.4)</p>
<p>> </p>
<p>> A character string literal is a sequence of zero or more multibyte characters enclosed in double-quotes, as in "xyz". A wide string literal is the same, except prefixed by the letter L. (...) The multibyte character sequence is then used to initialize an array of static storage duration and lenght just sufficient to contain the sequence.</p>
<p>Em C++ (padr√£o ISO de 98) o texto √© muito parecido, apenas abragendo tamb√©m o conceito de type-id (desnecess√°rio explicar para o contexto deste artigo):</p>
<p>> </p>
<p>> #### Sizeof (5.3.3)</p>
<p>> </p>
<p>> The sizeof operator yields the number of bytes in the object representation of its operand. The operand is either an expression, which is not evaluated, or a parenthesized type-id.</p>
<p>> </p>
<p>> #### String literal (2.13.4)</p>
<p>> </p>
<p>> A string literal is a sequence of characters (as defined in 2.13.2) surrounded by double quotes, optionally beginning with the letter L, as in "..." or L"...". (...) An ordinary string literal has type "array of n const char" and static storage duration (...).</p>
<p>Esses textos do padr√£o demonstram que o operador sizeof ir√° retornar o n√∫mero de bytes baseado no tipo do operando, e que o tipo de uma string literal √© de array de caracteres com o tamanho justo para caber a string.</p>
<p>Bem, todos sabemos o resultado das linhas abaixo:</p>
<p>    char charArray[100];</p>
<p>    size_t len = sizeof(charArray);</p>
<p>Nesse caso √© simples de observar que o operador sizeof ir√° retornar 100, que √© o n√∫mero em bytes para abrigar o tipo do operando, que √© de "array de 100 caracteres". Podemos, ent√£o, imaginar que a nossa idiom√°tica express√£o do in√≠cio √© no fundo um resumo das linhas que se seguem.</p>
<p>    ...</p>
<p>    static char aSimpleString[] = "A simple string";</p>
<p>    ...</p>
<p>    size_t len = sizeof(aSimpleString);</p>
<p>    memcpy(buf, aSimpleString, len);</p>
<p>Ou seja, o tipo de nossa string √© na verdade de array est√°tico de caracteres, como se uma vari√°vel tivesse sido definida anteriormente com o conte√∫do da string, que deve estar em algum lugar da mem√≥ria do programa. Visto dessa forma fica bem mais simples de entender o que acontece na vers√£o resumida.</p>
<p>O mais encorajador desse problema do sizeof √© que a resposta ing√™nua estava certa, ou seja, pelo menos dessa vez, o padr√£o conseguiu atrav√©s de suas regras seguir a intui√ß√£o do programador.</p>

</div>
  <div class="taglist">
  <p class="author">Wanderley Caloni,
     <a href="https://github.com/Caloni/blog/blob/master/content/posts/todo-dunno-original-post-source">
     2012-02-15 00:00:00 &#43;0000
     </a>
  </p>
  <a href="/categories/writting">writting</a> 
  <a href="/tags/movies">movies</a> 
  <a class="externalgray" href="https://t.me/paneloni">discuss</a>
  <script type="text/javascript" src="//cdn.livetrafficfeed.com/static/hitcounterjs/live.js?sty=49&min=1&sta=0&uni=1&tz=America%2FSao_Paulo&ro=0"></script><noscript id="LTF_hitcounter"><a href="https://livetrafficfeed.com/hit-counter">Hit Counter</a></noscript>
  </div>
  </div>
  </body>
  </html>
