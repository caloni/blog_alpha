<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Blogue do Caloni - 2 Coelhos</title>
  <meta name="author" content="" />
  <meta name="generator" content="Hugo 0.110.0">
  <meta property="og:title" content="2 Coelhos"/>
  <meta property="og:type"
        content="article"/>
  <meta property="og:url" content="http://www.caloni.com.br/todo-put-original-title-slug/"/>
  <meta property="og:image"
        content="/img/author.jpg"/>
  <meta property="og:description"
        content="Uma montagem impec·vel consegue dar o tom da narrativa do complexo 2 Coelhos. AlÈm de complexo, existem pequenos detalhes da trama que forÁam um pouco a realidade (como a uni„o entre o protagonista e..."/>
  <link href="" rel="feed" type="application/rss+xml"
        title="Blogue do Caloni"/>
  <link rel="stylesheet" type="text/css" href="/css/custom.css"/>
  <link rel="stylesheet" type="text/css" href="/css/jquery-ui.css"/>
  <link rel="stylesheet" type="text/css" href="/css/board-min.css"/>
  <script src="/js/jquery-1.10.2.js"></script>
  <script src="/js/jquery-ui.js"></script>
  <script src="/js/pgnyui.js"></script>
  <script src="/js/pgnviewer.js"></script>
  <script src="/js/list.js"></script>
  <link rel="icon" href="/img/favicon.ico"/>
</head>
<body style="min-height:100vh;display:flex;flex-direction:column">
  <nav class="navbar has-shadow is-white"
        role="navigation" aria-label="main navigation">
  <div class="container">
  <div class="navbar-brand">
  <pre><span style="font-size: 3px; margin: 0; display: block;">
&amp;*/. .*%@@@@@@@@@@@@&amp;/    , &amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@#,*@@@@%,*&amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@./@.(@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@**#./((,*, *./((*,#,&amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@.#@@%&amp;@@* (@@%&amp;@@/#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@,#@@&amp;&amp;@@, (@@&amp;&amp;@@*#@@@@@@@@@@@@@#/,,.         ..,/#&amp;@@@@@@@@@@@@@@@@@@@@@@@
@@@@@&amp;, .//      .//  .%@@@@@@&amp;#.  .,****.,*************,.  .(&amp;@@@@@@@@@@@@@@@@@
@@@*                     ,@/  .**,,,*********,   ,***,   ****    *@@@@@@@@@@@@@@
@#                         ,***      .******       ,***,*****,      *&amp;@@@@@@@@@@
&amp;                           ,**      .******.     .******************  (@@@@@@@@
                             ****..,*************************,    ,***   (@@@@@@
@@@@#,,,,,,,,,,,,,,,,,,,,*********,   ,**************,  .***,      .**. .  %@@@@
@@@@%                   .***,.,****,.,***,     ,****      ***.     ,******, /@@@
@@@@@&amp;.                ,**       *******,       *****,  .******************, *@@
@@@@@@@&amp;,            ,****      .********,.   .*************,  ,*****,    ,** /@
@@@@@@@@@@@@&amp;/ .****,    ************.   ****************************      **. #
@@@@@@@@@@@@@, *****,    ,***********    .******,   ,****.   .*****,***,,***** ,
@@@@@@@@@@@@&amp;..**************,  ,***********************       ,*,    ********..
@@@@@@@@@@@@&amp; ,**.    ,******.  .*******.    .**********,     .**********. .**, 
@@@@@@@@@@@@% ,*       ,***************.      .*****************************,   
@@@@@@@@@@@@@&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;@,(&amp;&amp;&amp;&amp;@,(&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;#*@&amp;&amp;&amp;@*#&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
@@@@@@@@@@@@@@@@@@@@@@@@@@@@(.#@@@@(.#@@@@@@@@@@@@@@@@@@@@@#**@@@@(.#@@@@@@@@@@@
  </span></pre>
  &nbsp;
  <a class="navbar-item" title="Go to Home" href="/">
    <div class="is-6">Blogue do Caloni</div>
  </a>
  </div>
  </div>
  </nav>
  <div class="container">
  <p class="title">
  <a class="external" href="https://www.caloni.com.br/todo-put-external-link-here">
  Todo Put Post Title Here
  </a>
  </p>
  <div class="content">
<p>Programar scripts em bash √© basicamente rodar os comandos j√° dispon√≠veis no modo shell a partir de um arquivo texto. Al√©m das constru√ß√µes de qualquer linguagem procedural como if e la√ßos de repeti√ß√£o o que √© mais usado √© o controle de entrada e sa√≠da dos comandos executados (e manipula√ß√£o de file descriptors), al√©m do controle sobre os signals durante as execu√ß√µes.</p>
<p>## Refer√™ncias</p>
<p> - [Bash Reference Manual](https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html)</p>
<p> - [Advanced Bash-Scripting Guide](https://tldp.org/LDP/abs/html/index.html)</p>
<p>```sh</p>
<p>ordenar_numeros() {</p>
<p>ordenar_numeros $1 $2 $3</p>
<p>```</p>
<p>Como voc√™ deve ter percebido lendo o primeiro script da sua vida vari√°veis em bash script come√ßam com `$`. As vari√°veis de `$0` a `$9` s√£o os argumentos do programa, mas de resto pode ser um nome qualquer e usado em qualquer lugar, mas caso voc√™ precise tornar o nome n√£o-amb√≠guo √© importante colocar entre chaves:</p>
<p>```sh</p>
<p>```</p>
<p>Como voc√™ j√° deve ter percebido lendo o primeiro script da sua vida comandos s√£o terminados por nova-linha ou por ponto-e-v√≠rgula, n√£o tendo briga para ningu√©m. Dois comandos n√£o podem conviver um do lado do outro e dar bom. √â por isso que caso voc√™ queira fazer um `if-then` na mesma linha precisa colocar um ponto-e-v√≠rgula antes de usar o `then`:</p>
<p>```sh</p>
<p>for i in "${numeros[@]}"; do</p>
<p>if [ $i -le $menor ]; then</p>
<p>```</p>
<p>## Preparando o terreno</p>
<p>H√° algumas dicas √∫teis para explicar para todos que mexem com bash script:</p>
<p> - Sempre setar antes de rodar um script a flag de execut√°vel (diferente do Windows, nem todos os arquivos possuem esse direito no Linux);</p>
<p> - Scripts podem/devem conter coment√°rios; o padr√£o de coment√°rios para tudo no Linux √© a cerquilha (#) no in√≠cio das linhas.</p>
<p>No come√ßo dos scripts em geral voc√™ ir√° notar a seguinte linha:</p>
<p>```sh</p>
<p>set -e</p>
<p>```</p>
<p>```sh</p>
<p>trap cleanup EXIT</p>
<p>cl_stack=()</p>
<p>cleanup() {</p>
<p>```</p>
<p>Note esta t√©cnica utilizada para incluir opera√ß√µes de limpeza dentro de um array, o `cl_stack`. No decorrer da execu√ß√£o do script se houver a necessidade de adicionar mais uma opera√ß√£o de limpeza o usu√°rio deve incluir esta opera√ß√£o neste array.</p>
<p>```sh</p>
<p>cl_stack+=( "kill pid" )</p>
<p>```</p>
<p>### Lendo par√¢metros de entrada</p>
<p>Para ler par√¢metros de entrada h√° um comando muito bom chamado getopt, mas por algum motivo ele n√£o √© muito popular nos scripts deste projeto. No lugar √© usada a leitura toscona dos par√¢metros pelas vari√°veis reservadas $1 a $9.</p>
<p>```sh</p>
<p>if [ "$1" = "" ] || [ ! -d ${LIB_ROOT}/libs/$2 ]; then</p>
<p>```</p>
<p>Voc√™ ir√° encontrar tamb√©m o shift de argumentos. Conforme voc√™ vai comendo os primeiros argumentos sendo passados para seu script o $2 poderia ser o $1, o $3 viraria o $2 e assim por diante, para facilitar o reaproveitamento de script e simplificar a contagem. √â particularmente √∫til para argumentos sem ordem espec√≠fica.</p>
<p>```sh</p>
<p>if [ $1 = "-b" ]; then</p>
<p>if [ $1 = "-d" ]; then</p>
<p>```</p>
<p>## Estrutura do c√≥digo</p>
<p>Abaixo as palavras reservadas para montar scripts. E √© s√≥. Em geral elas s√£o usadas para definir condi√ß√µes e rodar c√≥digo em loop. O resto s√£o comandos dispon√≠veis no sistema.</p>
<p>```</p>
<p>if      then   elif     else     fi        time</p>
<p>for     in     until    while    do        done</p>
<p>case    esac   coproc   select   function</p>
<p>```</p>
<p>## Evaluation</p>
<p>Avalia√ß√µes de express√µes e comandos √© um dos peda√ßos mais √∫teis em scripts bash. Voc√™ pode capturar a sa√≠da de um comando e guardar em uma vari√°vel ou usar uma vari√°vel como entrada de um comando, al√©m de criar novas vari√°veis atrav√©s da montagem de um ou mais comandos com outras strings. Em geral tudo que est√° dentro de `$()` pode ser usado como um minishell que ir√° executar e entregar o output.</p>
<p>```sh</p>
<p>tmpdir=$(mktemp -d)</p>
<p>mountdir=$(pwd)/subdir</p>
<p>echo "Today is $(date). What a lovely, lovely day!"</p>
<p>```</p>
<p>Evaluation precisa de redirects √†s vezes, e √†s vezes n√£o precisa de nenhum (`/dev/null`). No exemplo abaixo n√≥s queremos o id do usu√°rio de um arquivo sem nos preocupar com a sa√≠da de erro.</p>
<p>```sh</p>
<p>uid=$(stat -c %u ${mountdir}/data/file 2> /dev/null)</p>
<p>```</p>
<p>Voc√™ deve estar se perguntando se √© poss√≠vel usar outros file descriptors al√©m do 2. Sim, voc√™ pode. Abaixo de 10 √© mais ou menos seguro utilizar para file descriptors tempor√°rios. Acima de 10 √© poss√≠vel que entre em conflito com file descriptors dos pr√≥prios comandos sendo executados ou fds do sistema.</p>
<p>## Condi√ß√µes</p>
<p>Uma condi√ß√£o em bash pode ser feita entre colchetes simples, duplos e par√™nteses, cada uma dessas formas [sendo inventada](https://acloudguru.com/blog/engineering/conditions-in-bash-scripting-if-statements) para adicionar mais formas de expressar condi√ß√µes. √â importante ter sempre em m√£os tamb√©m as [diferentes checagens](https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Bash-Conditional-Expressions) que podem ser feitas dentro de um if.</p>
<p>### ifs</p>
<p>```sh</p>
<p>if [ $foo -ge 3 ]; then</p>
<p>if [ -f regularfile ]; then</p>
<p>if [ -r readablefile]; then</p>
<p>if <condition>; then<commands>fi</p>
<p>```</p>
<p>### if-elif-else</p>
<p>```sh</p>
<p>if [ -r somefile ]; then</p>
<p>elif [ -f somefile ]; then</p>
<p>else</p>
<p>```</p>
<p>### Dicas sobre uso do if</p>
<p> - Sempre mantenha espa√ßos entre os colchetes e a checagem/compara√ß√£o; e.g. erro: ‚Äúmissing `]'‚Äú;</p>
<p> - Palavras-chave n√£o podem compartilhar a mesma linha (mesmo comando); solu√ß√£o: ou coloque um ponto-e-v√≠rgula entre as palavras-chave ou quebra uma nova linha; e.g. erro: ‚Äúsyntax error near unexpected token `fi‚Äù;</p>
<p> - Vari√°veis do tipo strings podem conter espa√ßos e isso √© um problema para o comparador; solu√ß√£o: coloque sempre aspas entre vari√°veis do tipo string.</p>
<p>```sh</p>
<p>if [ "$1" = "" -o ! -f "$1" ]; then</p>
<p>```</p>
<p>### Brinde</p>
<p> - Voc√™ pode inverter uma condi√ß√£o colocando um ‚Äú!‚Äù na frente; `if [ ! -f regularfile ]; then`</p>
<p> - Voc√™ pode combinar condi√ß√µes usando certos operadores como -a (AND) e -o (OR); `if [ $foo -ge 3 -a $foo -lt 10 ]; then`</p>
<p> - As mesmas condi√ß√µes e regras podem ser usadas em outros comandos como while e until.</p>
<p>### Condi√ß√µes com colchetes-duplos</p>
<p>```sh</p>
<p>if [[ "$stringvar" == *string* ]]; then</p>
<p>if [[ "$stringvar" == *[sS]tring* ]]; then</p>
<p>if [[ $stringvarwithspaces != foo ]]; then</p>
<p>if [[ -a *.sh ]]; then</p>
<p>if [[ $num -eq 3 && "$stringvar" == foo ]]; then</p>
<p>if [[ "$title" =~ [^a-zA-Z0-9\ ] ]]; then</p>
<p>```</p>
<p> - Duplos-colchetes expandem vari√°veis como shell globbing (exemplo acima com asteriscos retorna verdade se houver string em qualquer parte de $stringvar;</p>
<p> - Por outro lado n√£o h√° file globbing (e por isso a condi√ß√£o -a acima funciona para um arquivo chamado *.sh);</p>
<p> - N√£o √© preciso usar aspas para strings que cont√©m espa√ßos (n√£o h√° divis√£o da vari√°vel);</p>
<p> - Syntax sugar: voc√™ pode usar operadores && e ||.</p>
<p>### Considera√ß√µes important√≠ssimas sobre ifs</p>
<p> - Operadores AND e OR s√£o short-circuit;</p>
<p> - 0 = true, >0 = false (C-like); por isso h√° comandos como `if ! tar etc; then "Error"; fi`.</p>
<p>### Brinde: switch-case</p>
<p>Sim, ele existe. E √© at√© bonitinho:</p>
<p>```sh</p>
<p>case $1 in</p>
<p>```</p>
<p>### Alguns comandos √∫teis do Linux para se divertir</p>
<p>## Debugging</p>
<p>Para depurar scripts bash use o par√¢metro `-x` para conseguir ver a execu√ß√£o de cada linha.</p>
<p>```sh</p>
<p>bash -x sort-number.sh 1 2 3</p>
<p>++ echo 'scale=2; ( 1 + 2 + 3 ) / 3'</p>
<p>++ bc -l</p>
<p>maior=3, menor=1, media=2.00</p>
<p>```</p>
<p>Ou se voc√™ precisar depurar apenas uma parte do script pode ligar e desligar o modo `-x` dentro do pr√≥prio script usando a mudan√ßa de modos como j√° aprendemos no come√ßo deste artigo.</p>
<p>```sh</p>
<p>for i in "${numeros[@]}"; do</p>
<p>```</p>
<p>```sh</p>
<p>bash sort-number.sh 1 2 3</p>
<p>maior=3, menor=1, media=2.00</p>
<p>```</p>
</div>
  <div class="taglist">
  <p class="author">Wanderley Caloni,
     <a href="https://github.com/Caloni/blog/blob/master/content/posts/todo-dunno-original-post-source">
     2012-02-15 00:00:00 &#43;0000
     </a>
  </p>
  <a href="/categories/writting">writting</a> 
  <a href="/tags/movies">movies</a> 
  <a class="externalgray" href="https://t.me/paneloni">discuss</a>
  <script type="text/javascript" src="//cdn.livetrafficfeed.com/static/hitcounterjs/live.js?sty=49&min=1&sta=0&uni=1&tz=America%2FSao_Paulo&ro=0"></script><noscript id="LTF_hitcounter"><a href="https://livetrafficfeed.com/hit-counter">Hit Counter</a></noscript>
  </div>
  </div>
  </body>
  </html>
