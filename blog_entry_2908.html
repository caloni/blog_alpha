<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Blogue do Caloni - 2 Coelhos</title>
  <meta name="author" content="" />
  <meta name="generator" content="Hugo 0.110.0">
  <meta property="og:title" content="2 Coelhos"/>
  <meta property="og:type"
        content="article"/>
  <meta property="og:url" content="http://www.caloni.com.br/todo-put-original-title-slug/"/>
  <meta property="og:image"
        content="/img/author.jpg"/>
  <meta property="og:description"
        content="Uma montagem impec·vel consegue dar o tom da narrativa do complexo 2 Coelhos. AlÈm de complexo, existem pequenos detalhes da trama que forÁam um pouco a realidade (como a uni„o entre o protagonista e..."/>
  <link href="" rel="feed" type="application/rss+xml"
        title="Blogue do Caloni"/>
  <link rel="stylesheet" type="text/css" href="/css/custom.css"/>
  <link rel="stylesheet" type="text/css" href="/css/jquery-ui.css"/>
  <link rel="stylesheet" type="text/css" href="/css/board-min.css"/>
  <script src="/js/jquery-1.10.2.js"></script>
  <script src="/js/jquery-ui.js"></script>
  <script src="/js/pgnyui.js"></script>
  <script src="/js/pgnviewer.js"></script>
  <script src="/js/list.js"></script>
  <link rel="icon" href="/img/favicon.ico"/>
</head>
<body style="min-height:100vh;display:flex;flex-direction:column">
  <nav class="navbar has-shadow is-white"
        role="navigation" aria-label="main navigation">
  <div class="container">
  <div class="navbar-brand">
  <pre><span style="font-size: 3px; margin: 0; display: block;">
&amp;*/. .*%@@@@@@@@@@@@&amp;/    , &amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@#,*@@@@%,*&amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@./@.(@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@**#./((,*, *./((*,#,&amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@.#@@%&amp;@@* (@@%&amp;@@/#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@,#@@&amp;&amp;@@, (@@&amp;&amp;@@*#@@@@@@@@@@@@@#/,,.         ..,/#&amp;@@@@@@@@@@@@@@@@@@@@@@@
@@@@@&amp;, .//      .//  .%@@@@@@&amp;#.  .,****.,*************,.  .(&amp;@@@@@@@@@@@@@@@@@
@@@*                     ,@/  .**,,,*********,   ,***,   ****    *@@@@@@@@@@@@@@
@#                         ,***      .******       ,***,*****,      *&amp;@@@@@@@@@@
&amp;                           ,**      .******.     .******************  (@@@@@@@@
                             ****..,*************************,    ,***   (@@@@@@
@@@@#,,,,,,,,,,,,,,,,,,,,*********,   ,**************,  .***,      .**. .  %@@@@
@@@@%                   .***,.,****,.,***,     ,****      ***.     ,******, /@@@
@@@@@&amp;.                ,**       *******,       *****,  .******************, *@@
@@@@@@@&amp;,            ,****      .********,.   .*************,  ,*****,    ,** /@
@@@@@@@@@@@@&amp;/ .****,    ************.   ****************************      **. #
@@@@@@@@@@@@@, *****,    ,***********    .******,   ,****.   .*****,***,,***** ,
@@@@@@@@@@@@&amp;..**************,  ,***********************       ,*,    ********..
@@@@@@@@@@@@&amp; ,**.    ,******.  .*******.    .**********,     .**********. .**, 
@@@@@@@@@@@@% ,*       ,***************.      .*****************************,   
@@@@@@@@@@@@@&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;@,(&amp;&amp;&amp;&amp;@,(&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;#*@&amp;&amp;&amp;@*#&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
@@@@@@@@@@@@@@@@@@@@@@@@@@@@(.#@@@@(.#@@@@@@@@@@@@@@@@@@@@@#**@@@@(.#@@@@@@@@@@@
  </span></pre>
  &nbsp;
  <a class="navbar-item" title="Go to Home" href="/">
    <div class="is-6">Blogue do Caloni</div>
  </a>
  </div>
  </div>
  </nav>
  <div class="container">
  <p class="title">
  <a class="external" href="https://www.caloni.com.br/todo-put-external-link-here">
  Todo Put Post Title Here
  </a>
  </p>
  <div class="content">
<p>Uma coisa que me espanta de vez em quando √© o total desconhecimento por programadores mais ou menos experientes dos n√≠veis de erros que podem ocorrer em um fonte escrito em C ou C++. Desconhe√ßo o motivo, mas desconfio que o fato de outras linguagens n√£o terem essa divis√£o de processos pode causar alguma nivela√ß√£o entre as linguagens e fazer pensar que o processo de compila√ß√£o em C √© como em qualquer outra linguagem.</p>
<p>Por√©m, para come√ßar, s√≥ de falarmos em compila√ß√£o j√° estamos pegando apenas um peda√ßo do todo, que √© a gera√ß√£o de um programa execut√°vel em C. Tradicionalmente, dividimos esse processo em tr√™s passos:</p>
<p>  1. Preprocessamento</p>
<p>  2. Compila√ß√£o</p>
<p>  3. Linkedi√ß√£o</p>
<p>Vamos dar uma olhada mais de perto em cada um deles e descobrir erros t√≠picos de cada processo.</p>
<p>O preprocessamento √© especificado pelos padr√µes C e C++, mas, tecnicamente, n√£o faz parte da linguagem. Ou seja, antes que qualquer regra de sintaxe seja verificada no c√≥digo-fonte, o preprocessamento j√° ter√° terminado.</p>
<p>Essa parte do processo lida com substitui√ß√£o de texto e diretivas baseadas em arquivos e s√≠mbolos. Por exemplo, a diretiva de preprocessamento mais conhecida</p>
<p>    #include <stdio.h></p>
<p>faz com que todo o conte√∫do do arquivo especificado seja inclu√≠do exatamente no ponto onde for colocada essa diretiva. Isso quer dizer que, antes sequer do c√≥digo-fonte ser compilado, todo o conte√∫do desse header padr√£o estar√° no corpo do arquivo C.</p>
<p>Para evitar que o mesmo header seja inclu√≠do in√∫meras vezes dentro da mesma unidade em C, causando assim erros de redefini√ß√£o, existe outra diretiva muito usada para cercar esses arquivos p√∫blicos:</p>
<p>    #ifndef __MEUHEADER__ // se j√° estiver definido, caio fora at√© endif</p>
<p>    #define __MEUHEADER__</p>
<p>    </p>
<p>    // conte√∫do do header</p>
<p>    </p>
<p>    #endif // __MEUHEADER__</p>
<p>Esse conjunto de duas diretivas, por si s√≥, √© capaz de gerar os mais criativos e bizarros erros de compila√ß√£o em C. E estamos falando de erros que ocorrem antes que sequer seja iniciado o processo de compila√ß√£o propriamente dito. Obviamente que os erros ser√£o capturados durante a compila√ß√£o, mas o motivo deles terem ocorrido foi um erro decorrente do processo de preprocessamento. Por exemplo, vamos supor que um determinado fonte necessita de uma declara√ß√£o de fun√ß√£o contida em meuheader.h:</p>
<p>    #include "header-do-mal.h"</p>
<p>    #include "meuheader.h"</p>
<p>    </p>
<p>    int func()</p>
<p>    {</p>
<p>       meuheaderFunc();</p>
<p>    }</p>
<p>Por√©m, num daqueles acasos da natureza, o header-do-mal.h define justamente o que n√£o poderia definir jamais (obs.: e isso pode muito bem acontecer na vida real, se usamos defini√ß√µes muito comuns):</p>
<p>    #ifndef __HEADERDOMAL__</p>
<p>    #define __HEADERDOMAL__</p>
<p>    </p>
<p>     // tirei header da jogada, huahuahua (risos mal√©ficos)</p>
<p>    #define __MEUHEADER__</p>
<p>    </p>
<p>    #endif // __HEADERDOMAL__</p>
<p>Na hora do preprocessamento, o preprocessador n√£o ir√° mais incluir o conte√∫do dentro de header.h:</p>
<p>    #ifndef __MEUHEADER__ // se j√° estiver definido, caio fora at√© endif</p>
<p>    #define __MEUHEADER__</p>
<p>    </p>
<p>    int meuheaderFunc(); // talvez algu√©m precise disso</p>
<p>    </p>
<p>    #endif // __MEUHEADER__</p>
<p>Conseq√ºentemente, durante a compila√ß√£o do c√≥digo-fonte j√° preprocessado, sem a declara√ß√£o da fun√ß√£o meuheaderFunc, ir√° ocorrer o seguinte erro:</p>
<p>    error C3861: 'meuheaderFunc': identifier not found</p>
<p>Isso em fontes pequenos √© facilmente identific√°vel. Em fontes maiores, √© preciso ter um pouco mais de cuidado.</p>
<p>Ap√≥s o processo de preprocessamento, de todos os arquivos indicados terem sido inclu√≠dos, de todas as macros terem sido substitu√≠das, todas as constantes colocadas literalmente no c√≥digo-fonte, temos  o que √© chamado unidade de compila√ß√£o, que ser√° entregue ao compilador, que, por sua vez, ir√° come√ßar a an√°lise sint√°tica de fato, descobrindo novos erros que podem ou n√£o (como vimos) ter a ver com a fase anterior. A figura abaixo ilustra esse processo, com algumas trocas conhecidas:</p>
<p>{{< image src="preprocessor.gif" caption="Preprocessor" >}}</p>
<p>Dica: quando o bicho estiver pegando, e tudo o que voc√™ sabe sobre linguagem C n√£o estiver te ajudando a resolver um problema, tente gerar uma unidade de compila√ß√£o em C e analisar sua sa√≠da. √Äs vezes o que √© claro no c√≥digo pode se tornar obscuro ap√≥s o preprocessamento. Para fazer isso no VC++ em linha de comando, use o par√¢metro /E.</p>
<p>Se voc√™ conseguir passar ileso para a fase de compila√ß√£o, pode se considerar um mestre do preprocessamento.  Por experi√™ncia pr√≥pria, posso afirmar que a maior parte do tempo gasto corrigindo erros de compila√ß√£o, por ironia do destino, n√£o ter√° origem na compila√ß√£o em si, mas no preprocessamento e linkedi√ß√£o. Isso porque o preprocessamento confunde muito o que vimos no nosso editor preferido, e a linkedi√ß√£o ocorre em uma fase onde n√£o importa mais o que est√° dentro das fun√ß√µes, mas sim o escopo de nomes, um assunto um pouco mais vago do que a linguagem C.</p>
<p>Na compila√ß√£o voc√™ ir√° encontrar geralmente erros bem comportados, como convers√£o entre tipos, else sem if e esquecimento de pontua√ß√£o ou par√™nteses.</p>
<p>    int cannotConvertError(const char* message)</p>
<p>    {</p>
<p>    	int ret = message[0];</p>
<p>    	return ret;</p>
<p>    }</p>
<p>    </p>
<p>    int ret = cannotConvertError(3);</p>
<p>    </p>
<p>    error C2664: 'cannotConvertError' : cannot convert parameter 1 from 'int' to 'const char *'</p>
<p>    if( test() )</p>
<p>    	something;</p>
<p>    	something-else;</p>
<p>    else</p>
<p>    	else-something;</p>
<p>    error C2181: illegal else without matching if</p>
<p>    while( (x < z) && func(x, func2(y) != 2 )</p>
<p>    {</p>
<p>    	something;</p>
<p>    }</p>
<p>    error C2143: syntax error : missing ')' before '{'</p>
<p>Claro, n√£o estamos falando de erros relacionados a templates, que s√£o um pesadelo √† parte.</p>
<p>Dica: nunca subestime o poder de informa√ß√£o do compilador e da sua documenta√ß√£o. Se o erro tem um c√≥digo (geralmente tem), procure a documenta√ß√£o sobre o c√≥digo de erro espec√≠fico, para ter uma id√©ia de por que esse erro costuma ocorrer, exemplos de c√≥digo com esse erro e poss√≠veis solu√ß√µes. Ficar batendo a cabe√ßa n√£o vai ajudar em nada, e com o tempo, voc√™ ir√° ficar sabendo rapidamente o que aconteceu.</p>
<p>Chegando na linkedi√ß√£o, onde a esperan√ßa reside, tudo pode vir por √°gua abaixo. Isso porque voc√™ j√° espera confiante que tudo d√™ certo, quando, na verdade, um erro bem colocado pode fazer voc√™ desistir pra sempre desse neg√≥cio de programar em C.</p>
<p>As caracter√≠sticas mais desejadas para corrigir erros nessa fase s√£o:</p>
<p>  1. Total conhecimento da fase do preprocessamento</p>
<p>  2. Total conhecimento da fase da compila√ß√£o</p>
<p>  3. Total conhecimento de n√≠veis de escopo e assinatura de fun√ß√µes</p>
<p>Os dois primeiros itens s√£o uma maldi√ß√£o previs√≠vel que deve-se carregar para todo o sempre. Se voc√™ n√£o consegue entender o que aconteceu nas duas primeiras fases, dificilmente ir√° conseguir seguir adiante com essa empreitada. O terceiro item significa que deve-se levar em conta as bibliotecas que estamos usando, headers externos (com depend√™ncias externas), conflitos entre nomes, etc.</p>
<p>Alguns erros mais encontrados aqui s√£o as fun√ß√µes n√£o encontradas por falta da LIB certa ou por LIBs desatualizadas que n√£o se encaixam mais com o projeto, fruto de muitas dores de cabe√ßa de manuten√ß√£o de c√≥digo. Essa √© a parte em que mais vale a pena saber organizar e definir uma interface clara entre os componentes de um projeto.</p>
<p>Do ponto de vista t√©cnico, √© a fase onde o linker junta todos os arquivos-objeto especificados, encontra as fun√ß√µes, m√©todos e classes necess√°rias e monta uma unidade execut√°vel, como ilustrado pela figura abaixo.</p>
<p>{{< image src="linker.gif" caption="Linker" >}}</p>
<p>Dica: uma LIB, ou biblioteca, nada mais √© que uma cole√ß√£o de arquivos-objeto que j√° foram compilados, ou seja, j√° passaram pelas duas primeiras fases, mas ainda n√£o foram linkeditados. Muitas vezes √© importante manter compatibilidade entre LIBs e os projetos que as usam, de forma que o processo de linkedi√ß√£o ocorra da maneira menos dolorosa poss√≠vel.</p>
<p>√â √≥bvio que, por ter passado pelas tr√™s fases de transforma√ß√£o de um c√≥digo-fonte em um programa execut√°vel, n√£o quer dizer que este programa est√° livre de erros. Os famigerados erros de l√≥gica podem se disfar√ßar at√© o √∫ltimo momento da compila√ß√£o e s√≥ se mostrarem quando o c√≥digo estiver rodando (de prefer√™ncia, no cliente).</p>
<p>Entre esses erros, os mais comuns costumam se aproveitar de macros, como max, que usa mais de uma vez o par√¢metro, que pode ser uma chamada com uma fun√ß√£o. A fun√ß√£o ser√° chamada duas vezes, mesmo que aparentemente no c√≥digo a chamada seja feita uma √∫nica vez:</p>
<p>    #define max(a, b) ( a > b ? a : b )</p>
<p>    </p>
<p>    int z = max( func(10), 30 );</p>
<p>Um outro erro que j√° encontrei algumas vezes √© quando a defini√ß√£o de uma classe tem um sizeof diferente do compilado em sua LIB, pela exclus√£o ou adi√ß√£o de novos membros. Isso pode (vai) fazer com que, durante a execu√ß√£o, a pilha seja corrompida, membros diferentes sejam acessados, entre outras traquinagens. Esses erros costumam acusar a falta de sincronismo entre os headers usados e suas reais implementa√ß√µes.</p>
<p>Enfim, na vida real, √© imposs√≠vel catalogar todos os erros que podem ocorrer em um fonte em C. Se isso fosse poss√≠vel, ou n√£o existiriam bugs, ou pelo menos existiria uma ferramenta para automaticamente procurar por esses erros e corrigi-los. Bom, existe o Lint.</p>

</div>
  <div class="taglist">
  <p class="author">Wanderley Caloni,
     <a href="https://github.com/Caloni/blog/blob/master/content/posts/todo-dunno-original-post-source">
     2012-02-15 00:00:00 &#43;0000
     </a>
  </p>
  <a href="/categories/writting">writting</a> 
  <a href="/tags/movies">movies</a> 
  <a class="externalgray" href="https://t.me/paneloni">discuss</a>
  <script type="text/javascript" src="//cdn.livetrafficfeed.com/static/hitcounterjs/live.js?sty=49&min=1&sta=0&uni=1&tz=America%2FSao_Paulo&ro=0"></script><noscript id="LTF_hitcounter"><a href="https://livetrafficfeed.com/hit-counter">Hit Counter</a></noscript>
  </div>
  </div>
  </body>
  </html>
