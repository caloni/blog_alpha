<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Blogue do Caloni - 2 Coelhos</title>
  <meta name="author" content="" />
  <meta name="generator" content="Hugo 0.110.0">
  <meta property="og:title" content="2 Coelhos"/>
  <meta property="og:type"
        content="article"/>
  <meta property="og:url" content="http://www.caloni.com.br/todo-put-original-title-slug/"/>
  <meta property="og:image"
        content="/img/author.jpg"/>
  <meta property="og:description"
        content="Uma montagem impec·vel consegue dar o tom da narrativa do complexo 2 Coelhos. AlÈm de complexo, existem pequenos detalhes da trama que forÁam um pouco a realidade (como a uni„o entre o protagonista e..."/>
  <link href="" rel="feed" type="application/rss+xml"
        title="Blogue do Caloni"/>
  <link rel="stylesheet" type="text/css" href="/css/custom.css"/>
  <link rel="stylesheet" type="text/css" href="/css/jquery-ui.css"/>
  <link rel="stylesheet" type="text/css" href="/css/board-min.css"/>
  <script src="/js/jquery-1.10.2.js"></script>
  <script src="/js/jquery-ui.js"></script>
  <script src="/js/pgnyui.js"></script>
  <script src="/js/pgnviewer.js"></script>
  <script src="/js/list.js"></script>
  <link rel="icon" href="/img/favicon.ico"/>
</head>
<body style="min-height:100vh;display:flex;flex-direction:column">
  <nav class="navbar has-shadow is-white"
        role="navigation" aria-label="main navigation">
  <div class="container">
  <div class="navbar-brand">
  <pre><span style="font-size: 3px; margin: 0; display: block;">
&amp;*/. .*%@@@@@@@@@@@@&amp;/    , &amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@#,*@@@@%,*&amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@./@.(@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@**#./((,*, *./((*,#,&amp;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@.#@@%&amp;@@* (@@%&amp;@@/#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@,#@@&amp;&amp;@@, (@@&amp;&amp;@@*#@@@@@@@@@@@@@#/,,.         ..,/#&amp;@@@@@@@@@@@@@@@@@@@@@@@
@@@@@&amp;, .//      .//  .%@@@@@@&amp;#.  .,****.,*************,.  .(&amp;@@@@@@@@@@@@@@@@@
@@@*                     ,@/  .**,,,*********,   ,***,   ****    *@@@@@@@@@@@@@@
@#                         ,***      .******       ,***,*****,      *&amp;@@@@@@@@@@
&amp;                           ,**      .******.     .******************  (@@@@@@@@
                             ****..,*************************,    ,***   (@@@@@@
@@@@#,,,,,,,,,,,,,,,,,,,,*********,   ,**************,  .***,      .**. .  %@@@@
@@@@%                   .***,.,****,.,***,     ,****      ***.     ,******, /@@@
@@@@@&amp;.                ,**       *******,       *****,  .******************, *@@
@@@@@@@&amp;,            ,****      .********,.   .*************,  ,*****,    ,** /@
@@@@@@@@@@@@&amp;/ .****,    ************.   ****************************      **. #
@@@@@@@@@@@@@, *****,    ,***********    .******,   ,****.   .*****,***,,***** ,
@@@@@@@@@@@@&amp;..**************,  ,***********************       ,*,    ********..
@@@@@@@@@@@@&amp; ,**.    ,******.  .*******.    .**********,     .**********. .**, 
@@@@@@@@@@@@% ,*       ,***************.      .*****************************,   
@@@@@@@@@@@@@&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;@,(&amp;&amp;&amp;&amp;@,(&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;#*@&amp;&amp;&amp;@*#&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
@@@@@@@@@@@@@@@@@@@@@@@@@@@@(.#@@@@(.#@@@@@@@@@@@@@@@@@@@@@#**@@@@(.#@@@@@@@@@@@
  </span></pre>
  &nbsp;
  <a class="navbar-item" title="Go to Home" href="/">
    <div class="is-6">Blogue do Caloni</div>
  </a>
  </div>
  </div>
  </nav>
  <div class="container">
  <p class="title">
  <a class="external" href="https://www.caloni.com.br/todo-put-external-link-here">
  Todo Put Post Title Here
  </a>
  </p>
  <div class="content">
<p>Pergunta de um leitor:</p>
<p>#### Leitor: Olhe essa bizarrice em C:</p>
<p>```</p>
<p>void func()</p>
<p>int main()</p>
<p>```</p>
<p>#### Leitor: Embora isso seja permitido, caso voc√™ coloque "void func(void)" j√° n√£o funciona mais. Por qu√™?</p>
<p>Resposta do Autor: Por que C √© zoado :P</p>
<p>OK, a verdade √© que n√£o existem (existiam?) muitas regras de sintaxe a serem respeitadas na linguagem pelo compilador. Antigamente, se n√£o fosse colocado nenhum tipo de retorno era como se ele fosse **int** por _default_. Da mesma forma, se n√£o colocar par√¢metros vale tudo. √â como se fossem os tr√™s pontinhos do __printf__. Afinal, voc√™ n√£o ia querer ficar repetindo os par√¢metros no .c e no .h, n√£o √© mesmo :D</p>
<p>Isso me lembra tamb√©m que havia a declara√ß√£o "arcaica" da linguagem (j√° era arcaica antes mesmo do padr√£o de 1998 sair):</p>
<p>```</p>
<p>void func()</p>
<p>char* sbrubles; /* isso √© um argumento de entrada */</p>
<p>```</p>
<p>#### Leitor: OK, entendi. Mas voltando para meu primeiro exemplo: supostamente usar um va_args pra ler "alguma coisa" certamente leria os par√¢metros, certo? E este par√¢metro, s√≥ fica inutilizado ou chega a dar algum problema mais s√©rio?</p>
<p>Sim, sua suposi√ß√£o a respeito do __va_args__ faz todo sentido. E n√£o, os par√¢metros n√£o s√£o inutilizados justamente porque a fun√ß√£o chamada pode fazer o que quiser que no retorno o chamador limpa a pilha (e o chamador sabe como ele empilhou os par√¢metros-extra).</p>
<p>S√≥ vai dar problema se definir outro padr√£o de chamada ou se a fun√ß√£o chamada mexer no que n√£o devia (se esperar outros tipos ou n√∫mero de argumentos, por exemplo).</p>
<p>### StdArgs na m√£o</p>
<p>Agora que sabemos disso, o comportamento do __va_list__ nem deve parecer t√£o m√°gico assim. Na verdade, apenas saber que a pilha √© onde est√£o todas as vari√°veis locais e os endere√ßos de retorno das fun√ß√µes √© o suficiente para explorar essa √°rea de mem√≥ria.</p>
<p>Por√©m, o uso can√¥nico na linguagem C e a forma mais educada de navegar nos par√¢metros extras √© usando o header stdarg.h. Isso porque C √© uma linguagem independente de plataforma, e _a priori_ n√£o temos a m√≠nima ideia de como os dados est√£o estruturados no computador. Essa vis√£o das vari√°veis locais e etc √© apenas algo que sabemos sobre a arquitetura PC (8086) porque j√° brincamos demais de _assembly_ e seus registradores.</p>
<p>```</p>
<p>int soma(int argc, ...);</p>
<p>int main()</p>
<p>	int resultado = soma(5, 2, 3, 4, 5, 6);</p>
<p>// soma.cpp</p>
<p>#include <stdarg.h></p>
<p>int soma(int argc, ...)</p>
<p>	va_list vl;</p>
<p>	va_start(vl, argc);</p>
<p>	return ret;</p>
<p>```</p>
<p>Uma vers√£o de quem j√° manja dos internals da arquitetura onde est√° programando e n√£o se importa com portabilidade poderia simplesmente caminhar pela pilha a partir do endere√ßo de argc.</p>
<p>```</p>
<p>int soma(int argc, ...)</p>
<p>	int ret = 0;</p>
<p>	int* argv = &argc + 1;</p>
<p>	while ( argc-- )</p>
<p>		int next = *argv++;</p>
<p>		ret += next;</p>
<p>	return ret;</p>
<p>```</p>
<p>Repetindo: isso n√£o √© bonito, apesar de simp√°tico. No entanto, se o objetivo √© explorar a arquitetura, fique √† vontade para navegar pela pilha a partir do endere√ßo das vari√°veis locais.</p>
</div>
  <div class="taglist">
  <p class="author">Wanderley Caloni,
     <a href="https://github.com/Caloni/blog/blob/master/content/posts/todo-dunno-original-post-source">
     2012-02-15 00:00:00 &#43;0000
     </a>
  </p>
  <a href="/categories/writting">writting</a> 
  <a href="/tags/movies">movies</a> 
  <a class="externalgray" href="https://t.me/paneloni">discuss</a>
  <script type="text/javascript" src="//cdn.livetrafficfeed.com/static/hitcounterjs/live.js?sty=49&min=1&sta=0&uni=1&tz=America%2FSao_Paulo&ro=0"></script><noscript id="LTF_hitcounter"><a href="https://livetrafficfeed.com/hit-counter">Hit Counter</a></noscript>
  </div>
  </div>
  </body>
  </html>
